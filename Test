[
  {
    "$match": {
      "inAppChannelPresent": true,
      "channels.type": "INAPP",
      "channels.status": "success",
      "recipients.recipientId": "sh12345"
    }
  },
  {
    "$group": {
      "_id": null,
      "totalCount": { "$sum": 1 },
      "unreadCount": {
        "$sum": {
          "$cond": [
            { "$eq": [ "$recipients.read", false ] },
            1,
            0
          ]
        }
      }
    }
  }
]






import org.springframework.data.mongodb.core.MongoTemplate;
import org.springframework.data.mongodb.core.aggregation.*;
import static org.springframework.data.mongodb.core.aggregation.Aggregation.*;

@Autowired
private MongoTemplate mongoTemplate;

public Map<String, Object> getCounts(String recipientId) {
    MatchOperation match = match(Criteria.where("inAppChannelPresent").is(true)
            .and("channels.type").is("INAPP")
            .and("channels.status").is("success")
            .and("recipients.recipientId").is(recipientId));

    GroupOperation group = group()
            .count().as("totalCount")
            .sum(ConditionalOperators.when(Criteria.where("recipients.read").is(false))
                    .then(1).otherwise(0))
            .as("unreadCount");

    Aggregation aggregation = newAggregation(match, group);

    AggregationResults<Map> results =
            mongoTemplate.aggregate(aggregation, "notifications", Map.class);

    return results.getUniqueMappedResult();
}




db.notifications.createIndex({
  "recipients.recipientId": 1,
  "recipients.read": 1,
  "channels.type": 1,
  "channels.status": 1,
  "inAppChannelPresent": 1
});

i ahve this mongo collection, i want to have one query that can give me total count and unread count from the collections, also suggent me the indexes that needs to be applied { "channels":[ {"type":"INAPP", "status":"success"} ], "recipients":[ {"recipientId":"sh12345","read":false} ], "inAppChannelPresent":true }, { "channels":[ {"type":"INAPP", "status":"success"} ], "recipients":[ {"recipientId":"sh12345","read":true} ], "inAppChannelPresent":true }
